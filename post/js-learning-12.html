<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="baidu-site-verification" content="j1Vv5VBdEX"><meta name="sogou_site_verification" content="5rKcZFfjtl"><meta name="360-site-verification" content="41ba3d1b4d5a1406eb63765d4c990146"><meta name="author" content="Tabliu"><meta name="keywords" content="大踏步走, 前端开发, 前端网站, javascript, vue"><meta name="description" content="一名80后前端开发者，专注前端开发和用户体验。天资愚钝，五体不勤，只能不停大踏步走。"><link rel="alternative" href="/atom.xml" title="大踏步走" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><title>JavaScript学习笔记（12）- 原型链 - 大踏步走</title><link rel="stylesheet" href="../css/main.css"><link rel="stylesheet" href="../js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="../js/jquery-3.1.1.min.js"></script><script src="../js/fancybox/jquery.fancybox.min.js"></script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?0e8fa2fbb74e1bdfda05935cbf42c755";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body style="opacity:0"><header class="head"><img class="head-avatar u-fl" src="/img/logo.png" alt="tabliu"><h1 class="head-title u-fl"><a href="/" title="大踏步走">大踏步走</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/">Home</a></li><li class="head-nav__item"><a class="head-nav__link" href="/archives">Writing</a></li><li class="head-nav__item"><a class="head-nav__link" href="https://github.com/tabliu/">Project</a></li><li class="head-nav__item"><a class="head-nav__link" href="/about">About</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time class="post__time" datetime="2018-07-27T01:00:00.000Z">July 27, 2018</time><h1 class="post__title"><a href="/post/js-learning-12.html">JavaScript学习笔记（12）- 原型链</a></h1><div class="post__main echo"><blockquote><p>JavaScript学习笔记。本笔记是基于在腾讯课堂《<a href="https://ke.qq.com/course/231577" target="_blank" rel="noopener">Web前端开发之JavaScript精英课堂【渡一教育】</a>》课程学习过程中记录的一些提纲和关键点。<br>强烈推荐想要进行js入门学习来听听，尤其是前面姬成讲的基础知识点。</p></blockquote><h2 id="原型链的定义"><a href="#原型链的定义" class="headerlink" title="原型链的定义"></a>原型链的定义</h2><pre class="language-javascript"><code class="language-javascript">Grand<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>lastName <span class="token operator">=</span> <span class="token string">'Liu'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> Grand <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">var</span> grand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Grand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Father<span class="token punctuation">.</span>prototype <span class="token operator">=</span> grand<span class="token punctuation">;</span>
<span class="token keyword">function</span> Father <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'laoda'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> father <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Son<span class="token punctuation">.</span>prototype <span class="token operator">=</span> father<span class="token punctuation">;</span>
<span class="token keyword">function</span> Son <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>ability <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">shot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> son <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>访问<code>son</code>相关属性会打印出如下内容：</p><p><img src="/demo/demo_05.png" alt="原型链属性"></p><p>我们通过打印对象<code>son</code>的属性可以发现：<code>son</code>不仅具有自身的对象属性，还继承其父级<code>father</code>的原型对象属性，同时也继承了其父级<code>father</code>的父级<code>Grand</code>的原型对象属性。<br>这种链式的继承关系，我们称之为原型链。</p><p>原型链的终端是<code>Object.prototype</code>。</p><h2 id="原型链的增删改查"><a href="#原型链的增删改查" class="headerlink" title="原型链的增删改查"></a>原型链的增删改查</h2><pre class="language-javascript"><code class="language-javascript">Grand<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>lastName <span class="token operator">=</span> <span class="token string">'Liu'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> Grand <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">var</span> grand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Grand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Father<span class="token punctuation">.</span>prototype <span class="token operator">=</span> grand<span class="token punctuation">;</span>
<span class="token keyword">function</span> Father <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'laoda'</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>fortune <span class="token operator">=</span> <span class="token punctuation">{</span>
    card1 <span class="token operator">=</span> <span class="token string">'visa'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> father <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Son<span class="token punctuation">.</span>prototype <span class="token operator">=</span> father<span class="token punctuation">;</span>
<span class="token keyword">function</span> Son <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>ability <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">shot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> son <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>通过不同的打印和赋值，查看结果：</p><p><img src="/demo/demo_06.png" alt="原型链操作"></p><p><code>son.fortune.card2 = &#39;Master&#39;</code>这种修改，是引用值自己的修改，相当于自己修改自己的属性，这不是赋值修改，是一种调用修改。这种也仅限于引用值的修改，原始值是不可以的。</p><p><code>son.fortune = 200</code>这种修改是赋值修改，相当于给自己加了属性。对原型不受影响。</p><pre class="language-javascript"><code class="language-javascript">Person<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
  height <span class="token punctuation">:</span> <span class="token number">100</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  eat <span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
person<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//101</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Person<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//100</span>
</code></pre><p>通过上例我们可以了解：原型链的增删改查基本和原型的增删改查规则一致。</p><pre class="language-javascript"><code class="language-javascript">Person<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span>
  sayName <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>以上代码我们在控制台输出<code>person.sayName()</code>打印结果是什么呢？答案是<code>a</code>，很好理解。</p><p>我们对构造函数<code>Person</code>增加一个属性：</p><pre class="language-javascript"><code class="language-javascript">Person<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span>
  sayName <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 如果直接写成name会报错，没有这个变量</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'b'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>现在控制台输出<code>person.sayName()</code>打印结果是什么呢？答案是<code>b</code>，如何理解。这里关键点在于<code>this</code>的指向是谁？</p><p><code>this</code>指向规则： <strong><em>谁调用这个方法，this就指向谁</em></strong>。</p><h2 id="原型的另一种创建方法：Object-create-原型"><a href="#原型的另一种创建方法：Object-create-原型" class="headerlink" title="原型的另一种创建方法：Object.create(原型)"></a>原型的另一种创建方法：<code>Object.create(原型)</code></h2><p>我们一般构建对象有两种方法：<code>var obj = {}</code> 或者 <code>var obj1 = new Object()</code>。这两种构建方法基本是一样的，我们推荐使用第一种自面量式的创建方法。而且这两种对象都有原型，其<code>__proto__</code>指向的是<code>Object</code>对象的终端。</p><p>通过<code>Object.create(原型)</code>也可以创建对象，但是必须要基于某个对象原型。</p><pre class="language-javascript"><code class="language-javascript">Person<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'sunny'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>

<span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> person1 <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>Person<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>上面<code>person</code>和<code>person1</code>两个对象的原型都是<code>Person.prototype</code>。</p><p>绝大多数对象最终都会继承自<code>Object.prototype</code>，但是，也存在一种例外。</p><p>我们通过<code>Object.create()</code>方法来创建一个对象，如果不添加原型会是什么情况？</p><p>如下图：</p><p><img src="/demo/demo_07.png" alt="原型创建对象"></p><p>报错内容提示：对象原型必须是一个对象或者<code>null</code>。</p><p>所以通过<code>Object.create()</code>方法来创建对象时，也可以使用<code>null</code>来创建一个没有原型的对象。但这个对象不具有<code>Object.prototype</code>的任何属性和方法。</p><p><img src="/demo/demo_08.png" alt="原型创建对象"></p><p>即使手动添加了<code>__proto__</code>对象，也和系统隐式的内置属性不是同一个，不具有<code>Object.prototype</code>的属性和方法。</p><h2 id="补充知识点：toString-方法"><a href="#补充知识点：toString-方法" class="headerlink" title="补充知识点：toString()方法"></a>补充知识点：<code>toString()</code>方法</h2><p><code>toString()</code>是原型的一个方法，通过调用返回字符串。</p><h3 id="undefined和null不能调用toString-方法"><a href="#undefined和null不能调用toString-方法" class="headerlink" title="undefined和null不能调用toString()方法"></a><code>undefined</code>和<code>null</code>不能调用<code>toString()</code>方法</h3><p><code>undefined</code>和<code>null</code>不是对象就没有原型，所以无法使用<code>toString()</code>方法。</p><p><img src="/demo/demo_09.png" alt="toString()方法"></p><h3 id="数字调用toString-方法"><a href="#数字调用toString-方法" class="headerlink" title="数字调用toString()方法"></a>数字调用<code>toString()</code>方法</h3><p>先看一个例子</p><pre class="language-javascript"><code class="language-javascript"><span class="token number">123</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>我们发现会报错。</p><p><img src="/demo/demo_10.png" alt="toString()方法"></p><p>为什么会这样呢？</p><p>因为<code>123.toString()</code>首先会被识别成浮点型，所以后面加<code>toString()</code>无法识别。</p><p>要使用<code>toString()</code>方法需要先定义一个变量，通过变量来调用。</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> num <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
num<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//'123'</span>
</code></pre><p>通过把<code>123</code>赋值给变量<code>num</code>，然后调用<code>toString()</code>方法输出字符串<code>&#39;123&#39;</code>。</p><p>我们知道原始值是无法直接调用原型<code>toString()</code>方法，这里其实是经过了一次包装类的转换。</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> num <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// num.toString(); --> new Number(num).toString();</span>
Number<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
Number<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> Object<span class="token punctuation">.</span>prototype
</code></pre><p><code>new Number()</code> 的原型是<code>Number.prototype</code>，原型<code>Number.prototype</code>有一个<code>toString()</code>方法；<code>Number.prototype</code>也有原型<code>Number.prototype.__proto__</code>对应的是<code>Object.prototype</code>，<code>Object.prototype</code>也具有<code>toString()</code>方法。</p><p>原型上有方法，自身又重新写了一个和原型同名功能不同的方法，叫做重写。</p><p>同名函数，重新方式不同。</p><p>调用时，如果是重写方法，会优先调用自身重写发方法。</p><p>所以上面<code>num.toString()</code>方法是调用了<code>Number.prototype.toString()</code>方法，如果调用<code>object.prototype.toString()</code>方法返回的结果就会不同。</p><p>类似的还有：</p><pre class="language-javascript"><code class="language-javascript">Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Number<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Boolean<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
String<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>再看一个好玩的例子：</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token number">123</span>
document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//123</span>

obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//[object Object]</span>

obj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>toString <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'老邓身体好！'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//老邓身体好！</span>
</code></pre><p>上面例子表面：通过<code>document.write(obj)</code>的打印结果，其实是<code>toString()</code>方法的返回结果，这也证明了<code>document.write()</code>调用的是<code>toString()</code>方法。</p><p>本节完。</p></div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/code/">code</a></li><li class="post__tag__item"><a class="post__tag__link" href="/tags/javascript/">javascript</a></li><li class="post__tag__item"><a class="post__tag__link" href="/tags/note/">note</a></li></ul></footer></article></main><footer class="foot"><div class="foot-copy">Copyright &copy; 2015-2018 <a href="/" title="大踏步走">Tabliu</a>theme by <a href="https://github.com/ochukai/hexo-theme-ochuunn/">ochuunn</a><a href="http://www.miibeian.gov.cn/" target="_blank">京ICP备13042587号-1</a></div></footer><script src="../js/scroller.js"></script><script src="../js/main.js"></script><script>!function(){var c="http:"==document.location.protocol?"http://js.passport.qihucdn.com/11.0.1.js?d8ae537cce9dbebc797b803cec7ed6ac":"https://jspassport.ssl.qhimg.com/11.0.1.js?d8ae537cce9dbebc797b803cec7ed6ac";document.write('<script src="'+c+'" id="sozz"><\/script>')}()</script></body></html>