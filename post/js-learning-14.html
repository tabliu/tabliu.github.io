<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="sogou_site_verification" content="5rKcZFfjtl"><meta name="360-site-verification" content="41ba3d1b4d5a1406eb63765d4c990146"><meta name="author" content="Tabliu"><meta name="keywords" content="大踏步走, 前端开发, 前端网站, javascript, vue"><meta name="description" content="一名80后前端开发者，专注前端开发和用户体验。天资愚钝，五体不勤，只能不停大踏步走。"><link rel="alternative" href="/atom.xml" title="大踏步走" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><title>JavaScript学习笔记（14）- 继承发展史 - 大踏步走</title><link rel="stylesheet" href="../css/main.css"><link rel="stylesheet" href="../js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="../js/jquery-3.1.1.min.js"></script><script src="../js/fancybox/jquery.fancybox.min.js"></script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?0e8fa2fbb74e1bdfda05935cbf42c755";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body style="opacity:0"><header class="head"><img class="head-avatar u-fl" src="/img/logo.png" alt="tabliu"><h1 class="head-title u-fl"><a href="/" title="大踏步走">大踏步走</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/">Home</a></li><li class="head-nav__item"><a class="head-nav__link" href="/archives">Writing</a></li><li class="head-nav__item"><a class="head-nav__link" href="https://github.com/tabliu/">Project</a></li><li class="head-nav__item"><a class="head-nav__link" href="/about">About</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time class="post__time" datetime="2018-07-31T02:00:00.000Z">July 31, 2018</time><h1 class="post__title"><a href="/post/js-learning-14.html">JavaScript学习笔记（14）- 继承发展史</a></h1><div class="post__main echo"><blockquote><p>JavaScript学习笔记。本笔记是基于在腾讯课堂《<a href="https://ke.qq.com/course/231577" target="_blank" rel="noopener">Web前端开发之JavaScript精英课堂【渡一教育】</a>》课程学习过程中记录的一些提纲和关键点。<br>强烈推荐想要进行js入门学习来听听，尤其是前面姬成讲的基础知识点。</p></blockquote><h2 id="继承的概念"><a href="#继承的概念" class="headerlink" title="继承的概念"></a>继承的概念</h2><blockquote><p>JavaScript中并没有真正意义上的继承，所谓的继承是利用不同方法来实现的。</p></blockquote><h2 id="继承的实现方法"><a href="#继承的实现方法" class="headerlink" title="继承的实现方法"></a>继承的实现方法</h2><h3 id="传统形式：原型链"><a href="#传统形式：原型链" class="headerlink" title="传统形式：原型链"></a>传统形式：原型链</h3><p>通过原型和原型链的方法来实现继承。</p><pre class="language-javascript"><code class="language-javascript">Grand<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>lastName <span class="token operator">=</span> <span class="token string">'Liu'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">Grand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>

<span class="token keyword">var</span> grand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Grand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Father<span class="token punctuation">.</span>prototype <span class="token operator">=</span> grand<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token keyword">var</span> father <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Son<span class="token punctuation">.</span>prototype <span class="token operator">=</span> father<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>

<span class="token keyword">var</span> son <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>用原型链实现继承在使用这些方法时会产生一些额外的且不希望产生的影响，过多的继承了一些没用的属性。</p><p>这种方法很早就被废弃。</p><h3 id="借用构造函数"><a href="#借用构造函数" class="headerlink" title="借用构造函数"></a>借用构造函数</h3><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> tel<span class="token punctuation">,</span> grade<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Person<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sex<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>tel <span class="token operator">=</span> tel<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>grade <span class="token operator">=</span> grade<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> studend <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'zhangsan'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> male<span class="token punctuation">,</span> <span class="token number">188</span><span class="token punctuation">,</span> <span class="token number">201801</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>这种方式是借用了<code>call()</code>或者<code>apply（）</code>方法来实现继承。这种方式不算标准的继承，因为无法继承借用构造函数的原型。</p><p>还有一个不太好的地方就是每次执行构造函数的时候还要多执行一个函数，造成效率浪费。</p><h3 id="公有原型"><a href="#公有原型" class="headerlink" title="公有原型"></a>公有原型</h3><pre class="language-javascript"><code class="language-javascript">Father<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>lastName <span class="token operator">=</span> <span class="token string">'Liu'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>

<span class="token keyword">var</span> father <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Son<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Father<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
<span class="token keyword">var</span> son <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>打印<code>son.lastName</code>输出<code>Liu</code>，很好的实现了继承。</p><p>我们可以把上面的继承方法封装成一个方法，方便不同构造函数的调用。</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">inherit</span><span class="token punctuation">(</span>Target<span class="token punctuation">,</span> Origin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Target<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Origin<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><p>通过原型共享实现继承，但对于继承的还是被继承的构造函数，不可以随便修改自己的原型，否则继承或者被继承的原型也会发生改变。</p><pre class="language-javascript"><code class="language-javascript">Father<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>lastName <span class="token operator">=</span> <span class="token string">'Liu'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">inherit</span><span class="token punctuation">(</span>Target<span class="token punctuation">,</span> Origin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Target<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Origin<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">inherit</span><span class="token punctuation">(</span>Son<span class="token punctuation">,</span> Father<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> father <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> son <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Son<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>sex <span class="token operator">=</span> <span class="token string">'male'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>son<span class="token punctuation">.</span>sex<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//male</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>father<span class="token punctuation">.</span>sex<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//male</span>
</code></pre><p>我们可以看到打印<code>father.sex</code>也会输出<code>male</code>，究其原因是因为<code>Father.prototype</code>受到<code>Son.prototype</code>的修改而发生变化。</p><h3 id="圣杯模式"><a href="#圣杯模式" class="headerlink" title="圣杯模式"></a>圣杯模式</h3><p>上例可看出：在共有原型中，对象试图改变自己原型的一些属性时将会影响到其他对象，这是我们不希望看到的情况。</p><p>我们希望：对象修改自己原型的一些属性，又保证不影响其他对象的原型。</p><p>这里就可以采用圣杯模式的方法来实现继承：</p><ul><li>通过创建一个构造函数<code>Temp</code>来充当中间层并共用原始构造函数<code>Origin</code>的原型；</li><li>让目标构造函数<code>Target</code>的原型通过中间层构造函数原型链<code>new Temp()</code>来产生继承；</li></ul><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">inherit</span><span class="token punctuation">(</span>Target<span class="token punctuation">,</span> Origin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">Temp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  Temp<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Origin<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
  Target<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Temp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>回到上例中：</p><pre class="language-javascript"><code class="language-javascript">Father<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>lastName <span class="token operator">=</span> <span class="token string">'Liu'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">inherit</span><span class="token punctuation">(</span>Target<span class="token punctuation">,</span> Origin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">Temp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  Temp<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Origin<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
  Target<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Temp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">inherit</span><span class="token punctuation">(</span>Son<span class="token punctuation">,</span> Father<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> father <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> son <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Son<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>sex <span class="token operator">=</span> <span class="token string">'male'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>son<span class="token punctuation">.</span>sex<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//male</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>father<span class="token punctuation">.</span>sex<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//undefined</span>
</code></pre><p><code>Son</code>修改原型<code>Son.prototype.sex = &#39;male&#39;</code>并不会影响到<code>Father</code>的原型，从而达到我们期望的效果。</p><p>我们知道对象都有一个属性<code>constructor</code>来指向对象构造函数，我们看上例中<code>son</code>的<code>constructor</code>是谁呢？</p><p><img src="/demo/demo_11.png" alt="constructor属性"></p><pre class="language-javascript"><code class="language-javascript">son<span class="token punctuation">.</span>__proto__ <span class="token operator">--</span><span class="token operator">></span> <span class="token keyword">new</span> <span class="token class-name">Temp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__proto__ <span class="token operator">--</span><span class="token operator">></span> Father<span class="token punctuation">.</span>prototype
</code></pre><p>通过输出和分析我们得知：<code>son</code>的<code>constructor</code>是<code>function Father() {}</code>，这样在实际使用有些混乱，我们可以把这个构造器进行归位，同时记录其原始构造器以备后用：</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">inherit</span><span class="token punctuation">(</span>Target<span class="token punctuation">,</span> Origin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">Temp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  Temp<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Origin<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
  Target<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Temp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Target<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Target<span class="token punctuation">;</span>
  Target<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>origin <span class="token operator">=</span> Origin<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>这样就完成了一个完整的圣杯模式的方法。</p><p>再看下<code>YUI</code>中圣杯模式的写法：</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> inherit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> Temp <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span>Target<span class="token punctuation">,</span> Origin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Temp<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Origin<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
    Target<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Temp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Target<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Target<span class="token punctuation">;</span>
    Target<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>origin <span class="token operator">=</span> Origin<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">inherit</span><span class="token punctuation">(</span>Son<span class="token punctuation">,</span> Father<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//调用</span>
</code></pre><p>这里用到了闭包的一个作用：<strong><em>可以实现封装，属性私有化</em></strong>。</p><p>用立即执行函数和返回匿名函数来形成闭包，导致函数体中的<code>Temp</code>形成一个私有化变量。</p><p>通过圣杯模式很好的解决了对象的继承和避免原型相互依赖和影响的问题。</p><p>本节完。</p></div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/code/">code</a></li><li class="post__tag__item"><a class="post__tag__link" href="/tags/javascript/">javascript</a></li><li class="post__tag__item"><a class="post__tag__link" href="/tags/note/">note</a></li></ul></footer></article></main><footer class="foot"><div class="foot-copy">Copyright &copy; 2015-2018 <a href="/" title="大踏步走">Tabliu</a>theme by <a href="https://github.com/ochukai/hexo-theme-ochuunn/">ochuunn</a><a href="http://www.miibeian.gov.cn/" target="_blank">京ICP备13042587号-1</a></div></footer><script src="../js/scroller.js"></script><script src="../js/main.js"></script><script>!function(){var c="http:"==document.location.protocol?"http://js.passport.qihucdn.com/11.0.1.js?d8ae537cce9dbebc797b803cec7ed6ac":"https://jspassport.ssl.qhimg.com/11.0.1.js?d8ae537cce9dbebc797b803cec7ed6ac";document.write('<script src="'+c+'" id="sozz"><\/script>')}()</script></body></html>