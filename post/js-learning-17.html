<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="sogou_site_verification" content="5rKcZFfjtl"><meta name="360-site-verification" content="41ba3d1b4d5a1406eb63765d4c990146"><meta name="author" content="Tabliu"><meta name="keywords" content="大踏步走, 前端开发, 前端网站, javascript, vue"><meta name="description" content="一名80后前端开发者，专注前端开发和用户体验。天资愚钝，五体不勤，只能不停大踏步走。"><link rel="alternative" href="/atom.xml" title="大踏步走" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><title>JavaScript学习笔记（17）- JS中的this - 大踏步走</title><link rel="stylesheet" href="../css/main.css"><link rel="stylesheet" href="../js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="../js/jquery-3.1.1.min.js"></script><script src="../js/fancybox/jquery.fancybox.min.js"></script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?0e8fa2fbb74e1bdfda05935cbf42c755";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body style="opacity:0"><header class="head"><img class="head-avatar u-fl" src="/img/logo.png" alt="tabliu"><h1 class="head-title u-fl"><a href="/" title="大踏步走">大踏步走</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/">Home</a></li><li class="head-nav__item"><a class="head-nav__link" href="/archives">Writing</a></li><li class="head-nav__item"><a class="head-nav__link" href="https://github.com/tabliu/">Project</a></li><li class="head-nav__item"><a class="head-nav__link" href="/about">About</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time class="post__time" datetime="2018-08-03T01:40:00.000Z">August 3, 2018</time><h1 class="post__title"><a href="/post/js-learning-17.html">JavaScript学习笔记（17）- JS中的this</a></h1><div class="post__main echo"><blockquote><p>JavaScript学习笔记。本笔记是基于在腾讯课堂《<a href="https://ke.qq.com/course/231577" target="_blank" rel="noopener">Web前端开发之JavaScript精英课堂【渡一教育】</a>》课程学习过程中记录的一些提纲和关键点。<br>强烈推荐想要进行js入门学习来听听，尤其是前面姬成讲的基础知识点。</p></blockquote><h2 id="一、this的使用"><a href="#一、this的使用" class="headerlink" title="一、this的使用"></a>一、this的使用</h2><h3 id="函数预编译过程中this指向window"><a href="#函数预编译过程中this指向window" class="headerlink" title="函数预编译过程中this指向window"></a>函数预编译过程中<code>this</code>指向<code>window</code></h3><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//预编译环节</span>
AO <span class="token punctuation">{</span>
  arguments <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token keyword">this</span> <span class="token punctuation">:</span> window<span class="token punctuation">,</span>
  c <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
  a <span class="token punctuation">:</span> undefined<span class="token punctuation">,</span>
  b <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

</code></pre><p>如果该函数是构造函数，在执行<code>new test()</code>过程中<code>this</code>会发生改变：</p><pre class="language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//this = Object.create(test.prototype);</span>
<span class="token comment" spellcheck="true">//相当于</span>
<span class="token comment" spellcheck="true">//{</span>
<span class="token comment" spellcheck="true">//  __proto__ : test.prototype</span>
<span class="token comment" spellcheck="true">//}</span>
</code></pre><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><h3 id="全局作用域中this指向window"><a href="#全局作用域中this指向window" class="headerlink" title="全局作用域中this指向window"></a>全局作用域中<code>this</code>指向<code>window</code></h3><h3 id="call和apply可以改变函数运行是的this指向"><a href="#call和apply可以改变函数运行是的this指向" class="headerlink" title="call和apply可以改变函数运行是的this指向"></a><code>call</code>和<code>apply</code>可以改变函数运行是的<code>this</code>指向</h3><h3 id="obj-func-里func-里面的this指向ojb"><a href="#obj-func-里func-里面的this指向ojb" class="headerlink" title="obj.func();里func()里面的this指向ojb"></a><code>obj.func();</code>里<code>func()</code>里面的<code>this</code>指向<code>ojb</code></h3><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  name <span class="token punctuation">:</span> <span class="token string">'abc'</span><span class="token punctuation">,</span>
  a <span class="token punctuation">:</span>  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
obj<span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>对象里函数中的<code>this</code>指向：<strong><em>谁调用的这个方法，<code>this</code>就指向谁</em></strong>。</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'222'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  name <span class="token punctuation">:</span> <span class="token string">'111'</span><span class="token punctuation">,</span>
  say <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> fun <span class="token operator">=</span> a<span class="token punctuation">.</span>say<span class="token punctuation">;</span>
<span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//function() {</span>
<span class="token comment" spellcheck="true">//  console.log(this.name); //this指向window，结果'222'</span>
<span class="token comment" spellcheck="true">//}</span>
a<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//function() {</span>
<span class="token comment" spellcheck="true">//  console.log(this.name); //this指向a，结果'111'</span>
<span class="token comment" spellcheck="true">//}</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token punctuation">{</span>
  name <span class="token punctuation">:</span> <span class="token string">'333'</span><span class="token punctuation">,</span>
  say <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>fun<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
b<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>say<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//function() {</span>
<span class="token comment" spellcheck="true">//  console.log(this.name); //this指向window，结果'222'</span>
<span class="token comment" spellcheck="true">//}</span>
b<span class="token punctuation">.</span>say <span class="token operator">=</span> a<span class="token punctuation">.</span>say<span class="token punctuation">;</span>
b<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//function() {</span>
<span class="token comment" spellcheck="true">//  console.log(this.name); //this指向b，结果'333'</span>
<span class="token comment" spellcheck="true">//}</span>
</code></pre><h2 id="其他知识点"><a href="#其他知识点" class="headerlink" title="其他知识点"></a>其他知识点</h2><h3 id="arguments-callee"><a href="#arguments-callee" class="headerlink" title="arguments.callee"></a>arguments.callee</h3><blockquote><p>指向函数自身的引用。</p></blockquote><p>举个栗子：求10的阶乘</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> num <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> n <span class="token operator">*</span> arguments<span class="token punctuation">.</span><span class="token function">callee</span><span class="token punctuation">(</span>n<span class="token number">-1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>一般的做法是定义一个实名函数<code>fac(n)</code>，通过枚举的方法来循环调用<code>fac(n) * fac(n-1)</code>；但如果是通过立即执行函数来实现，就无法循环调用函数名，只能通过<code>argumengs.callee</code>来调用自身。</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>callee<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>callee<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>根据函数执行顺序从上到下执行，先执行<code>function a()</code>中<code>console.log(arguments.callee);</code>；再执行<code>function b()</code>中<code>console.log(arguments.callee);</code>。所以返回结果也是：<code>function a(){}</code>和<code>function b(){}</code>。</p><p>总结：<code>arguments.callee</code>返回的是<strong><em>当前执行环境下的函数体</em></strong>。</p><h3 id="func-caller"><a href="#func-caller" class="headerlink" title="func.caller"></a>func.caller</h3><blockquote><p>返回调用函数的函数体。</p></blockquote><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>caller<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//null</span>
  <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>caller<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//function a() { b(); }</span>
<span class="token punctuation">}</span>
<span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><code>function a() {}</code>函数没有任何调用；<code>function b() {}</code>被<code>function a() {}</code>调用执行，所以返回结果：<code>null</code>和<code>function a() { b(); }</code></p><p>总结：</p><ul><li>这两个方法经常会拿来一起比较，但实际开发中很少用到；</li><li>在ES5语法中，这两个方法不可用。</li></ul><h3 id="三目运算符"><a href="#三目运算符" class="headerlink" title="三目运算符"></a>三目运算符</h3><blockquote><p>条件判断 ? 是 : 否 并且会返回值</p></blockquote><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> num <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token string">'10'</span> <span class="token operator">></span> <span class="token string">'9'</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token number">1</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 字符串相比是比的主位ask码</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//1</span>
</code></pre><h2 id="课后练习"><a href="#课后练习" class="headerlink" title="课后练习"></a>课后练习</h2><h3 id="求console-log打印结果？"><a href="#求console-log打印结果？" class="headerlink" title="求console.log打印结果？"></a>求<code>console.log</code>打印结果？</h3><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> test <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token number">234</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>打印结果是：<code>234</code>。</p><p>如果执行<code>new test();</code>的打印结果呢？</p><p>返回：<code>123</code>。</p><h3 id="运行test-和new-test-的结果分别是什么？"><a href="#运行test-和new-test-的结果分别是什么？" class="headerlink" title="运行test()和new  test()的结果分别是什么？"></a>运行<code>test()</code>和<code>new test()</code>的结果分别是什么？</h3><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> test <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> a<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//test();</span>
  <span class="token comment" spellcheck="true">// A0 {</span>
  <span class="token comment" spellcheck="true">//   a : undefined;</span>
  <span class="token comment" spellcheck="true">// }</span>
  <span class="token comment" spellcheck="true">//a = 0;</span>
  <span class="token comment" spellcheck="true">//console.log(a); //0</span>
  <span class="token comment" spellcheck="true">//console.log(this.a); //5</span>
  <span class="token comment" spellcheck="true">//var a;</span>
  <span class="token comment" spellcheck="true">//console.log(a); //0</span>

  <span class="token comment" spellcheck="true">//new test();</span>
  <span class="token comment" spellcheck="true">// this == Object.create(test.prototype);</span>
  <span class="token comment" spellcheck="true">// A0 {</span>
  <span class="token comment" spellcheck="true">//   a : undefined;</span>
  <span class="token comment" spellcheck="true">// }</span>
  <span class="token comment" spellcheck="true">//a = 0;</span>
  <span class="token comment" spellcheck="true">//console.log(a); //0</span>
  <span class="token comment" spellcheck="true">//console.log(this.a); //undefined</span>
  <span class="token comment" spellcheck="true">//var a;</span>
  <span class="token comment" spellcheck="true">//console.log(a); //0</span>

</code></pre><p>总结：</p><p><code>this</code>考题涉及到的知识点：</p><ul><li>函数预编译(AO)；</li><li><code>this</code>指向问题；</li><li>函数和构造函数的预编译差异。</li></ul><h2 id="课后作业"><a href="#课后作业" class="headerlink" title="课后作业"></a>课后作业</h2><h3 id="浅克隆"><a href="#浅克隆" class="headerlink" title="浅克隆"></a>浅克隆</h3><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  name <span class="token punctuation">:</span> <span class="token string">'abc'</span><span class="token punctuation">,</span>
  age <span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
  sex <span class="token punctuation">:</span> <span class="token string">'male'</span><span class="token punctuation">,</span>
  card <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'visa'</span><span class="token punctuation">,</span> <span class="token string">'life'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'card1'</span><span class="token punctuation">,</span> <span class="token string">'card2'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">clone</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> target <span class="token operator">=</span> target <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> prop <span class="token keyword">in</span> origin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> origin<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> target<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">clone</span><span class="token punctuation">(</span>obj1<span class="token punctuation">,</span> obj2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>浅克隆的方法很好实现，但也存在一个问题。如果对象的属性值是非原始值，那目标对象和原始对象都会指向到相同的索引上，改变一方，另一方也会发生改变。</p><p>现实项目中是不希望发生的，这样就需要用到深克隆的方法来实现。</p><h3 id="深克隆"><a href="#深克隆" class="headerlink" title="深克隆"></a>深克隆</h3><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  name <span class="token punctuation">:</span> <span class="token string">'abc'</span><span class="token punctuation">,</span>
  age <span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
  sex <span class="token punctuation">:</span> <span class="token string">'male'</span><span class="token punctuation">,</span>
  card <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'visa'</span><span class="token punctuation">,</span> <span class="token string">'life'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'card1'</span><span class="token punctuation">,</span> <span class="token string">'card2'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  wife <span class="token punctuation">:</span> <span class="token punctuation">{</span>
    name <span class="token punctuation">:</span> <span class="token string">'bcd'</span><span class="token punctuation">,</span>
    son <span class="token punctuation">:</span> <span class="token punctuation">{</span>
      name <span class="token punctuation">:</span> <span class="token string">'cdde'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><p>分析思路：</p><ul><li>遍历对象：<code>for(var prop in obj)</code></li><li>判断是否是原始值：<code>typeof(obj[prop]) == Object</code></li><li>判断是否是数组还是对象： <code>constructor/instanceof/toString()</code>三种方法，推荐使用<code>toString()</code></li><li>建立相应的数组或者对象：<code>[] or {}</code></li><li>递归</li></ul><p>实现：</p><pre class="language-javascript"><code class="language-javascript">  <span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'abc'</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
    sex<span class="token punctuation">:</span> <span class="token string">'male'</span><span class="token punctuation">,</span>
    card<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'visa'</span><span class="token punctuation">,</span> <span class="token string">'life'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'card1'</span><span class="token punctuation">,</span> <span class="token string">'card2'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    wife<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">'bcd'</span><span class="token punctuation">,</span>
      son<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token string">'cdde'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> target <span class="token operator">=</span> target <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      toStr <span class="token operator">=</span> Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">,</span>
      arrStr <span class="token operator">=</span> <span class="token string">'[object Array]'</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> prop <span class="token keyword">in</span> origin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>origin<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>origin<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">'null'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> <span class="token punctuation">(</span>origin<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>toStr<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>origin<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> arrStr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token function">deepClone</span><span class="token punctuation">(</span>origin<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">,</span> target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> origin<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> target<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><p>使用三目运算符还看简化下代码：</p><pre class="language-javascript"><code class="language-javascript">  <span class="token keyword">function</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> target <span class="token operator">=</span> target <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      toStr <span class="token operator">=</span> Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">,</span>
      arrStr <span class="token operator">=</span> <span class="token string">'[object Array]'</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> prop <span class="token keyword">in</span> origin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>origin<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>origin<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">'null'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> <span class="token punctuation">(</span>origin<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment" spellcheck="true">// if (toStr.call(origin[prop]) == arrStr) {</span>
          <span class="token comment" spellcheck="true">//   target[prop] = [];</span>
          <span class="token comment" spellcheck="true">// } else {</span>
          <span class="token comment" spellcheck="true">//   target[prop] = {}</span>
          <span class="token comment" spellcheck="true">// }</span>
          target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> toStr<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>originp<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">==</span> arrStr<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
          <span class="token function">deepClone</span><span class="token punctuation">(</span>origin<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">,</span> target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> origin<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> target<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><p>总结：</p><p>在实现深克隆功能的过程中一定要注意一下几个问题：</p><ol><li><code>Object.prototype.toString</code>的使用；</li><li><code>hasOwnProperty()</code>的使用；</li><li><code>===</code>与<code>==</code>的区别使用；</li><li><code>typeof</code> 的返回结果都是小写的字符串。</li></ol><p>本节完。</p></div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/code/">code</a></li><li class="post__tag__item"><a class="post__tag__link" href="/tags/javascript/">javascript</a></li><li class="post__tag__item"><a class="post__tag__link" href="/tags/note/">note</a></li></ul></footer></article></main><footer class="foot"><div class="foot-copy">Copyright &copy; 2015-2018 <a href="/" title="大踏步走">Tabliu</a>theme by <a href="https://github.com/ochukai/hexo-theme-ochuunn/">ochuunn</a><a href="http://www.miibeian.gov.cn/" target="_blank">京ICP备13042587号-1</a></div></footer><script src="../js/scroller.js"></script><script src="../js/main.js"></script><script>!function(){var c="http:"==document.location.protocol?"http://js.passport.qihucdn.com/11.0.1.js?d8ae537cce9dbebc797b803cec7ed6ac":"https://jspassport.ssl.qhimg.com/11.0.1.js?d8ae537cce9dbebc797b803cec7ed6ac";document.write('<script src="'+c+'" id="sozz"><\/script>')}()</script></body></html>